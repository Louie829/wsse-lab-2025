openapi: "3.0.0"

info:
  title: "Student Enrollment API"
  version: "0.2.0"
  description: "API for student enrollment with Cognito OAuth2 scopes."

servers:
  - url: "https://api.example.edu/api/v1"
    description: "Mock server SRU + version"

paths:
  /health:
    get:
      summary: "Health check"
      description: "æœå‹™æ˜¯å¦æ­£å¸¸ï¼ˆæ­¤ç«¯é»å…è¨±åŒ¿åå‘¼å«ï¼‰"
      security: []   # è¦†å¯«å…¨åŸŸï¼Œä¸éœ€ OAuth2
      responses:
        "200":
          description: "OK"
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"

  /students:
    get:
      summary: "List students"
      description: "éœ€è¦ students.read scope"
      responses:
        "200":
          description: "Success - students list returned."

    post:
      summary: "Create student"
      description: "éœ€è¦ students.write scope"
      security:
        - CognitoOAuth2: [students.write]   # è¦†å¯«ï¼Œåªéœ€ write æ¬Šé™
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StudentCreate"
      responses:
        "201":
          description: "Student created"
          headers:
            Location:
              description: "URL of created resource"
              schema:
                type: string
                example: "/api/v1/students/102"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Student"
        "400":
          description: "Invalid input"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  securitySchemes:
    CognitoOAuth2:
      type: oauth2
      flows:
        authorizationCode:   # Labä½¿ç”¨ PKCE + Authorization Code
          authorizationUrl: "https://<domain>.auth.<region>.amazoncognito.com/oauth2/authorize"
          tokenUrl:         "https://<domain>.auth.<region>.amazoncognito.com/oauth2/token"
          scopes:
            students.read:  "Read student data"
            students.write: "Create/modify student data"

  schemas:
    Student:
      type: object
      properties:
        id:
          type: integer
          example: 102
        name:
          type: string
          example: "Alice"
        email:
          type: string
          format: email
          example: "alice@example.com"
      required: [id, name, email]

    StudentCreate:
      type: object
      properties:
        name:
          type: string
          example: "Bob"
        email:
          type: string
          format: email
          example: "bob@example.com"
      required: [name, email]

    Error:
      type: object
      properties:
        code:
          type: string
          example: "BadRequest"
        message:
          type: string
          example: "Invalid request payload"
      required: [code, message]

# ğŸŒ å…¨åŸŸé è¨­è‡³å°‘éœ€å…·å‚™ read scope
security:
  - CognitoOAuth2: [students.read]
